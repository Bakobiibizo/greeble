<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>Local SEO Audit Dashboard</title>
  <link rel="stylesheet" href="/static/greeble/greeble-core.css">
  <link rel="stylesheet" href="/static/greeble/score-gauge.css">
  <link rel="stylesheet" href="/static/greeble/forecast-chart.css">
  <link rel="stylesheet" href="/static/greeble/factor-breakdown.css">
  <link rel="stylesheet" href="/static/greeble/metric-grid.css">
  <link rel="stylesheet" href="/static/greeble/citation-list.css">
  <link rel="stylesheet" href="/static/greeble/audit-dashboard.css">
  <script src="https://unpkg.com/htmx.org@1.9.10"></script>
  <style>
    body {
      font-family: -apple-system, BlinkMacSystemFont, 'Segoe UI', Roboto, sans-serif;
      min-height: 100vh;
    }
    /* Dark mode toggle */
    .theme-toggle {
      background: var(--greeble-color-surface);
      border: 1px solid var(--greeble-color-border);
      border-radius: 999px;
      padding: 0.5rem;
      cursor: pointer;
      display: flex;
      align-items: center;
      justify-content: center;
      width: 2.5rem;
      height: 2.5rem;
      transition: background 0.2s;
    }
    .theme-toggle:hover { background: var(--greeble-color-border); }
    .theme-toggle svg { width: 1.25rem; height: 1.25rem; color: var(--greeble-color-foreground); }
    .theme-toggle .icon-sun { display: none; }
    .theme-toggle .icon-moon { display: block; }
    .dark .theme-toggle .icon-sun { display: block; }
    .dark .theme-toggle .icon-moon { display: none; }

    /* Targets section */
    .targets-section {
      background: var(--greeble-color-surface);
      border: 1px solid var(--greeble-color-border);
      border-radius: var(--greeble-radius-medium, 12px);
      padding: var(--greeble-spacing-4, 1rem);
      margin-bottom: var(--greeble-spacing-4, 1rem);
    }
    .targets-section__header {
      display: flex;
      align-items: center;
      justify-content: space-between;
      margin-bottom: var(--greeble-spacing-3, 0.75rem);
    }
    .targets-section__form {
      display: flex;
      gap: var(--greeble-spacing-2, 0.5rem);
      flex-wrap: wrap;
      margin-bottom: var(--greeble-spacing-3, 0.75rem);
      padding-bottom: var(--greeble-spacing-3, 0.75rem);
      border-bottom: 1px solid var(--greeble-color-border);
    }
    .targets-section__form .greeble-input { flex: 1; min-width: 150px; }
    .targets-grid {
      display: grid;
      grid-template-columns: repeat(auto-fill, minmax(280px, 1fr));
      gap: var(--greeble-spacing-3, 0.75rem);
    }
    .target-card {
      background: var(--greeble-color-background);
      border: 1px solid var(--greeble-color-border);
      border-radius: var(--greeble-radius-medium, 12px);
      padding: var(--greeble-spacing-3, 0.75rem);
      cursor: pointer;
      transition: border-color 0.2s, box-shadow 0.2s;
    }
    .target-card:hover {
      border-color: var(--greeble-color-accent);
      box-shadow: 0 0 0 1px var(--greeble-color-accent);
    }
    .target-card.selected {
      border-color: var(--greeble-color-accent);
      box-shadow: 0 0 0 2px var(--greeble-color-accent);
    }
    .target-card__name {
      font-weight: 600;
      color: var(--greeble-color-foreground);
      margin-bottom: 0.25rem;
    }
    .target-card__url {
      font-size: 0.75rem;
      color: var(--greeble-color-muted);
      overflow: hidden;
      text-overflow: ellipsis;
      white-space: nowrap;
    }
    .target-card__meta {
      display: flex;
      align-items: center;
      justify-content: space-between;
      margin-top: var(--greeble-spacing-2, 0.5rem);
      font-size: 0.75rem;
    }
    .target-card__status {
      padding: 0.125rem 0.5rem;
      border-radius: 999px;
      font-weight: 500;
    }
    .target-card__status--pending {
      background: var(--greeble-color-border);
      color: var(--greeble-color-muted);
    }
    .target-card__status--ready {
      background: rgba(34, 197, 94, 0.15);
      color: #22c55e;
    }
    .target-card__actions {
      display: flex;
      gap: 0.5rem;
    }
    .target-card__btn {
      padding: 0.25rem 0.5rem;
      font-size: 0.75rem;
      border-radius: 6px;
      border: 1px solid var(--greeble-color-border);
      background: var(--greeble-color-surface);
      color: var(--greeble-color-foreground);
      cursor: pointer;
    }
    .target-card__btn:hover { background: var(--greeble-color-border); }
    .target-card__btn--primary {
      background: var(--greeble-color-accent);
      border-color: var(--greeble-color-accent);
      color: #fff;
    }
    .target-card__btn--primary:hover { background: #8f1c08; }
    .targets-empty {
      text-align: center;
      padding: var(--greeble-spacing-4, 1rem);
      color: var(--greeble-color-muted);
      font-size: 0.875rem;
    }
  </style>
  <script>
    (function() {
      const saved = localStorage.getItem('theme');
      if (saved === 'dark') document.documentElement.classList.add('dark');
    })();
  </script>
</head>
<body>
  <div class="greeble-audit-dashboard" data-greeble-audit-dashboard>
    <!-- Header -->
    <header class="greeble-audit-dashboard__header">
      <h1 class="greeble-heading-2">Local SEO Intelligence</h1>
      <button type="button" class="theme-toggle" onclick="toggleTheme()" aria-label="Toggle dark mode">
        <svg class="icon-moon" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
          <path d="M21 12.79A9 9 0 1 1 11.21 3 7 7 0 0 0 21 12.79z"/>
        </svg>
        <svg class="icon-sun" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
          <circle cx="12" cy="12" r="5"/><path d="M12 1v2M12 21v2M4.22 4.22l1.42 1.42M18.36 18.36l1.42 1.42M1 12h2M21 12h2M4.22 19.78l1.42-1.42M18.36 5.64l1.42-1.42"/>
        </svg>
      </button>
    </header>

    <!-- Targets Section -->
    <section class="targets-section">
      <div class="targets-section__header">
        <h2 class="greeble-heading-3">Audit Targets</h2>
      </div>
      
      <!-- Add Target Form -->
      <form class="targets-section__form" 
            hx-post="/api/targets" 
            hx-target="#targets-grid" 
            hx-swap="innerHTML"
            hx-on::after-request="this.reset()">
        <input type="text" name="name" class="greeble-input" placeholder="Business name" required>
        <input type="url" name="url" class="greeble-input" placeholder="https://example.com" required>
        <button type="submit" class="greeble-button greeble-button--primary">Add Target</button>
      </form>

      <!-- Targets Grid -->
      <div id="targets-grid" class="targets-grid" hx-get="/api/targets" hx-trigger="load">
        <div class="targets-empty">Loading targets...</div>
      </div>
    </section>

    <!-- Loading indicator -->
    <div id="audit-loading" class="greeble-audit-dashboard__loading htmx-indicator">
      <svg class="greeble-audit-dashboard__spinner" viewBox="0 0 24 24">
        <circle cx="12" cy="12" r="10" stroke="currentColor" stroke-width="3" fill="none" stroke-dasharray="60" stroke-linecap="round"/>
      </svg>
      <span>Running audit...</span>
    </div>

    <!-- Results container -->
    <div id="audit-results" class="greeble-audit-dashboard__results">
      <div class="greeble-audit-dashboard__empty">
        <p>Select a target above and click "Run Audit" to generate a report.</p>
      </div>
    </div>
  </div>

  <script>
    function toggleTheme() {
      const html = document.documentElement;
      const isDark = html.classList.toggle('dark');
      localStorage.setItem('theme', isDark ? 'dark' : 'light');
    }

    function selectTarget(card) {
      document.querySelectorAll('.target-card').forEach(c => c.classList.remove('selected'));
      card.classList.add('selected');
    }
  </script>
</body>
</html>
